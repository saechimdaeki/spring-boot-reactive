# 7장 스프링 부트 메시징

앞서 6장에서는 스프링 부트를 사용해서 API 서버를 만드는 방법을 심도 있게 살펴봤다. 요청을 입력받아서 원천 데이터를 전통적인 JSON 형태로

반환하는 서버를 만들었고, 하이퍼미디어의 진정한 힘을 제대로 활용할 수 있는 스프링 HATEOAS를 사용해서 구 버전 호환성을 지닌 API서버도 

만들어봤다. 이제 메시지 연결을 활용해서 컴포넌트 사이의 결합도를 낮추도록 아키텍쳐를 고도화해보자. 비동기 메시징은 동일한 애플리케이션 안에

있는 컴포넌트들 또는 네트워크를 통해 연결된 여러 마이크로서비스에 분산돼 있는 컴포넌트들을 연결하는 좋은 수단이 될 수 있다.

이번 7장에서 다룰 내용은 다음과 같다

- 스프링 부트에서 지원하는 다양한 메시징 솔루션
- 스프링 부트에서 직접 지원하지는 않지만 스프링 포트폴리오에서 지원하는 다양한 메시징 솔루션
- AMQP를 자세히 알아보고, 스프링 AMQP와 프로젝트 리액터를 활용해 웹 계층과 백엔드의 결합관계 해소

## 메시징 솔루션 선택

메시징 솔루션은 JMS, 아파치 카프카, AMQP, 레디스, 젬파이어, 아파치 지오드 등 매우 다양하다. 이 솔루션들은 공통점도 많지만 저마다

다른 관심사에 최적화돼 있다. 어떤 솔루션이 어떤 시나리오에 맞는지는 시나리오에 따라 모두 다르므로 이책에서는 다루지 않는다. 

대신에, 메시징을 활용하고 리액티브 스트림 프로그래밍에 적절히 통합하는 방법을 배운다.

## 익숙한 패턴을 사용한 문제 해결

개별 솔루션에 대한 얘기를 이어가기 전에 자바의 복잡도 감소가 스프링 포트폴리오의 핵심 특징이라는 점을 이해해야한다. 스프링의 설계 목표는

무엇보다도 애플리케이션을 만드는 방법을 단순화하는 것이다. 이를 달성하는 가장 강력한 수단 중 하나가 `템플릿 패턴이다`. 이 템플릿 패턴은 아주

강력해서 GOF디자인 패턴 책에도 포함돼있다. 본질적으로 `템플릿` 이란 특정 API의 모든 복잡성을 가장 단순한 연산으로 축약하는 것을 의미한다.

템플릿 중 가장 대표적인 것은 `JdbcTemplate`이다. JDBC를 직접 사용하면 개발자가 쿼리문 작성, DB연결 관리를 모두 신경 써야 하고, 2백여 개의

쿼리를 작성한 후에는 혹시 `ResultSet`을 닫지 않고 종료 처리한 것이 있는지 하나하나 살펴봐야 한다. 

스프링 프레임워크는 `JdbcTemplate`을 만들었다. `JdbcTemplate` 을 활용하면 몇가지 연산만 사용해서 데이터 조회와 수정을 처리할 수 있다.

개발자는 SQL쿼리문과 쿼리 결과 처리 방법만 제공하면 된다. DB 연결, 커서, 결과 구성 , ResultSet 닫기 등은 모두 스프링이 알아서 대신 처리해준다

결국 JdbcTemplate이 자원 관리를 맡아서 실수 없이 처리하고 개발자는 고객 요구사항에 집중할 수 있다. 템플릿 패턴은 너무 강력해서 MailSender,

JndiTemplate, HibernateTemplate, JdoTemplate 등 여러 영역에서 두루 사용되고 있다. 그리고 다음과 같은 비동기 메시징에서도 사용된다

- `JMS`: 자바 표준 메시징 API, 스프링 프레임워크는 JMS 브로커를 사용한 메시지 송신과 수신을 쉽게 처리할 수있도록 JmsTemplate과

  DefaultMessageListenerContainer를 제공한다

- `아파치 카프카`: 빠른 속도로 대세로 자리 잡고있는 브로커, 스프링 아파치 카프카는 아파치 카프카를 사용한 메시지 송신과 수신을 쉽게 처리할 수 

  있도록 KafkaTemplate과 KafkaMessageListenerContainer를 제공한다

- `레빗엠큐(RabbitMQ)`:높은 처리량과 강한 회복력이 특징인 메시지 브로커, 스프링 AMQP는 레빗엠큐를 사용한 메시지 송신과 수신을 쉽게

  처리할 수 있도록 AmqpTemplateSimpleMessageListenerContainer를 제공한다

- `레디스(Redis)`: 빠른 속도를 무기로 가장 널리사용되는 브로커. 스프링 데이터 레디스는 레디스를 사용하는 메시지 송신과 수신을 쉽게 처리할 수 

  있도록 RedisMessageListenerContainer를 제공한다

직접 구현하면 복잡할 수 있는 API를 획기적으로 단순화한 발행-구독(pub-sub) 관련 유틸리티를 사용하면 쉽게 메시지를 발행할 수 있게 해주고, 

메시지를 받아서 처리하는 메시지 리스너도 쉽게 등록할 수 있게 해준다

## 손쉬운 테스트

AMQP 브로커인 레빗엠큐를 사용하는 테스트를 중심으로 메시지 처리 방법을 알아보자. 



